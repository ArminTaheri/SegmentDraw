// Build date: 2017-06-14T14:51:20

/*
* Author    Jonathan Lurie - http://me.jonahanlurie.fr
* License   MIT
* Link      https://github.com/jonathanlurie/PlaneShifter
* Lab       MCIN - http://mcin.ca/ - Montreal Neurological Institute
*/
(function(e,c){"object"===typeof exports&&"undefined"!==typeof module?c(exports):"function"===typeof define&&define.amd?define(["exports"],c):c(e.SegmentDraw=e.SegmentDraw||{})})(this,function(e){var c=null,a=function(b,a,g,d){d=void 0===d?{}:d;this._requireThree();this._enabled=!0;this._container=b;this._camera=g;this._scene=a;this._boundingBox=new c.Box3(new c.Vector3(-Infinity,-Infinity,-Infinity),new c.Vector3(Infinity,Infinity,Infinity));this._controls=this._getOption(d,"controls",null);this._mouse=
this._getOption(d,"mouse",new c.Vector2(Infinity,Infinity));this._useReferenceMouse=!!d.mouse;this._pointClicked3D=null;this._raycaster=new c.Raycaster;this._drawKey=this._getOption(d,"drawKey","Space");this._hideKey=this._getOption(d,"hideKey","Escape");this._segmentThickness=this._getOption(d,"segmentThickness",6);this._segmentColor=this._getOption(d,"segmentColor","#6600aa");this._mouseDown=!1;this._sampleSegment={segment:null,started:!1};this._orbitData={};this._drawModeEnabled=!1;this._customEvents=
{startInteraction:[],stopInteraction:[],draw:[]};this._initSamplingSegment();this._initEvents()};a.prototype._initSamplingSegment=function(){var b=new THREE.LineBasicMaterial({color:this._segmentColor,linewidth:this._segmentThickness,linecap:"square"}),a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0));this._sampleSegment={segment:new THREE.Line(a,b),started:!1};this._sampleSegment.segment.name="sampling_segment";this._sampleSegment.segment.visible=!1;this._scene.add(this._sampleSegment.segment)};
a.prototype._requireThree=function(){try{c=window&&window.THREE||require("three")}catch(b){try{c=require("three")}catch(f){console.error(f)}}};a.prototype._getOption=function(b,a,c){return b?b[a]||c:c};a.prototype._initEvents=function(){window.addEventListener("mousemove",this._onMouseMove.bind(this),!1);window.addEventListener("mousedown",this._onMouseDown.bind(this),!1);window.addEventListener("mouseup",this._onMouseUp.bind(this),!1);window.addEventListener("keyup",this._onKeyUp.bind(this),!1);
window.addEventListener("keydown",this._onKeyDown.bind(this),!1)};a.prototype._onMouseMove=function(b){this._enabled&&(this._useReferenceMouse||(this._mouse.x=event.clientX/window.innerWidth*2-1,this._mouse.y=2*-(event.clientY/window.innerHeight)+1),this._sampleSegment.started&&this._continueSegment(this._raycast()))};a.prototype._onMouseDown=function(b){this._enabled&&(this._mouseDown=!0,this._drawModeEnabled&&this._startSegment(this._raycast()))};a.prototype._startSegment=function(b){b&&(this._sampleSegment.started=
!0,this._sampleSegment.segment.geometry.vertices[0].copy(b),this._sampleSegment.segment.geometry.vertices[1].copy(b),this._sampleSegment.segment.visible=!0,this._sampleSegment.segment.geometry.verticesNeedUpdate=!0)};a.prototype._continueSegment=function(b){b&&(this._sampleSegment.segment.geometry.vertices[1].copy(b),this._sampleSegment.segment.geometry.verticesNeedUpdate=!0,this._triggerEvents("draw",[this._sampleSegment.segment.geometry.vertices[0].clone(),this._sampleSegment.segment.geometry.vertices[1].clone()]))};
a.prototype._onMouseUp=function(b){this._enabled&&(this._mouseDown=!1,this._sampleSegment.started=!1)};a.prototype._onKeyUp=function(b){if(this._enabled)switch(b.code){case this._drawKey:this._drawModeEnabled=!1;this._sampleSegment.started=!1;this._enableControl();this._triggerEvents("stopInteraction");break;case this._hideKey:this.hide()}};a.prototype._onKeyDown=function(b){this._enabled&&b.code===this._drawKey&&!this._drawModeEnabled&&(this._drawModeEnabled=!0,this._disableControl(),this._triggerEvents("startInteraction"))};
a.prototype.setBoundingBox=function(b){this._boundingBox=b.clone()};a.prototype.hide=function(){this._sampleSegment.segment.visible=!1};a.prototype._raycast=function(){this._raycaster.setFromCamera(this._mouse,this._camera);for(var b=this._raycaster.intersectObject(this._container,!0),a=0;a<b.length;a++)if(this._boundingBox.containsPoint(b[a].point))return b[a].point;return null};a.prototype._disableControl=function(){this._controls&&(this._controls.enabled&&this._saveOrbitData(),this._controls.enabled=
!1)};a.prototype._enableControl=function(){this._controls&&!this._controls.enabled&&(this._controls.enabled=!0,this._restoreOrbitData())};a.prototype._saveOrbitData=function(){this._orbitData={target:new c.Vector3,position:new c.Vector3,zoom:this._controls.object.zoom};this._orbitData.target.copy(this._controls.target);this._orbitData.position.copy(this._controls.object.position)};a.prototype._restoreOrbitData=function(){this._controls.position0.copy(this._orbitData.position);this._controls.target0.copy(this._orbitData.target);
this._controls.zoom0=this._orbitData.zoom;this._controls.reset()};a.prototype.enable=function(b){this._enabled=b};a.prototype.on=function(b,a){"function"===typeof a&&b in this._customEvents&&this._customEvents[b].push(a)};a.prototype._triggerEvents=function(b,a){a=void 0===a?null:a;if(b in this._customEvents){b=this._customEvents[b];for(var c=0;c<b.length;c++)b[c].apply(null,a)}};e.SegmentDraw=a;Object.defineProperty(e,"__esModule",{value:!0})});
